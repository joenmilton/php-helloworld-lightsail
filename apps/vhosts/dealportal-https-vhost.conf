<VirtualHost 127.0.0.1:443 _default_:443>
    ServerName portal.techyline.com
    ServerAlias www.portal.techyline.com
    SSLEngine on

    # SSLCertificateFile "/opt/bitnami/apache/conf/bitnami/certs/server.crt"
    # SSLCertificateKeyFile "/opt/bitnami/apache/conf/bitnami/certs/server.key"

    SSLCertificateFile "/etc/letsencrypt/live/portal.techyline.com/fullchain.pem"
    SSLCertificateKeyFile "/etc/letsencrypt/live/portal.techyline.com/privkey.pem"

    # Serve React build files
    DocumentRoot /opt/bitnami/apache/apps/dealportal
    <Directory "/opt/bitnami/apache/apps/dealportal">
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted

        # Enable URL rewriting for React Router
        RewriteEngine On
        RewriteBase /

        # If the request is for a file that exists, serve it directly
        RewriteCond %{REQUEST_FILENAME} -f
        RewriteRule ^(.*)$ $1 [L]

        # If the request is not for an existing file or directory, serve index.html
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ /index.html [L]

    </Directory>

    # Allow access to fonts directory
    <Directory "/opt/bitnami/apache/apps/dealportal/fonts">
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
    
    # Reverse Proxy for API requests
    ProxyPass "/api" "https://backoffice.techyline.com/api"
    ProxyPassReverse "/api" "https://backoffice.techyline.com/api"
    SSLProxyEngine On
</VirtualHost>